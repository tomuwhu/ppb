<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js'></script>
<script src="https://s3.amazonaws.com/stitch-sdks/js/library/v3/stable/stitch.min.js"></script>
<script>
angular
  .module('a', [])
  .controller('c', ($scope, $interval) => {
	const clientPromise = stitch.StitchClientFactory.create('tom-xxvtd')
	$scope.f = () => {
		if ($scope.t>0) {
			clientPromise.then(client => {
				let db = client.service('mongodb', 'mongodb-atlas').db('p1')
				client.login().then(() => {
				  console.log($scope.t)
				  db.collection('thing').updateOne({owner_id: client.authedId()}, {$set:{number:$scope.t}}, {upsert:true})
				}).catch(err => {
				  console.error(err)
				})
			})
		}
	}
	$interval( () => {
		clientPromise.then(client => {
			let db = client.service('mongodb', 'mongodb-atlas').db('p1')
			client.login().then(()=>
			  db.collection('thing').find().limit(10).execute()
			).then(docs => {
			  $scope.tomb = docs
			}).catch(err => {
			  //console.error(err)
			})
		})
	}, 1000 )
  })
</script>
<meta charset="utf-8">
<body ng-app="a" ng-controller="c">
<input ng-model="t" ng-change="f()">
{{tomb}}
</body>